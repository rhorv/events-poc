<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="
                http://www.springframework.org/schema/beans
                http://www.springframework.org/schema/beans/spring-beans.xsd">

  <bean id="rjs1SchemaProvider" class="events.formatter.edaJsonSerDes.EDAJsonHardCodedSchemaProvider"/>
  <bean id="rjs1Deserializer" class="events.formatter.edaJsonSerDes.Rjs1Deserializer">
    <constructor-arg ref="rjs1SchemaProvider"/>
  </bean>
  <bean id="rjs1Serializer" class="events.formatter.edaJsonSerDes.Rjs1Serializer">
    <constructor-arg ref="schemaProvider"/>
  </bean>
  <bean id="decoratedRjs1Serializer" class="events.formatter.edaJsonSerDes.SerializedValidatorDecorator">
    <constructor-arg ref="rjs1Serializer"/>
    <constructor-arg ref="rjs1SchemaProvider"/>
  </bean>

  <bean id="messageFamilyAwareDeserializer" class="events.formatter.MessageFamilyAwareDeserializer">
    <constructor-arg>
      <map>
        <entry key="#{T(events.formatter.edaJsonSerDes.Rjs1Deserializer).NAME}" value-ref="rjs1Deserializer"/>
        <entry key="#{T(events.formatter.hav1.Hav1Deserializer).NAME}" value-ref="hav1Deserializer"/>
      </map>
    </constructor-arg>
  </bean>

  <bean id="edaAvroGenericSerialiser" class="events.formatter.edaAvroSerDes.EdaAvroGenericSerialiser">
    <constructor-arg ref="edaFileBasedSchemaProvider"/>
  </bean>
  <bean id="edaAvroGenericDeserialiser" class="events.formatter.edaAvroSerDes.EdaAvroGenericDeserialiser">
    <constructor-arg ref="schemaProvider"/>
  </bean>

  <bean id="guavaDispatcher" class="events.dispatcher.guava.GuavaDispatcher">
  </bean>

  <bean id="rabbitConnectionFactory" class="com.rabbitmq.client.ConnectionFactory">
    <property name="username" value="admin"/>
    <property name="password" value="admin123"/>
    <property name="host" value="rabbitmq"/>
    <property name="port" value="5672"/>
    <property name="virtualHost" value="/"/>
  </bean>

  <bean id="kafkaConsumer" class="events.consumer.kafka.KafkaTopicConsumer">
    <constructor-arg ref="deserializer"/>
    <constructor-arg ref="dispatcher"/>
    <constructor-arg value="kafka:9092"/>
    <constructor-arg value="testtopic"/>
  </bean>
  <bean id="rabbitConsumer" class="events.consumer.rabbitmq.RabbitMqConsumer">
    <constructor-arg ref="deserializer"/>
    <constructor-arg ref="dispatcher"/>
    <constructor-arg ref="rabbitConnectionFactory"/>
    <constructor-arg value="testqueue"/>
  </bean>

  <bean id="kafkaEventPublisher" class="events.publisher.kafka.KafkaTopicPublisher">
    <constructor-arg ref="serializer"/>
    <constructor-arg value="kafka:9092"/>
    <constructor-arg value="testtopic"/>
  </bean>
  <bean id="kafkaCommandPublisher" class="events.publisher.kafka.KafkaTopicPublisher">
    <constructor-arg ref="serializer"/>
    <constructor-arg value="kafka:9092"/>
    <constructor-arg value="othertopic"/>
  </bean>
  <bean id="rabbitEventPublisher" class="events.publisher.rabbitmq.RabbitMqPublisher">
    <constructor-arg ref="serializer"/>
    <constructor-arg ref="rabbitConnectionFactory"/>
    <constructor-arg value="events"/>
  </bean>
  <bean id="rabbitCommandPublisher" class="events.publisher.rabbitmq.RabbitMqPublisher">
    <constructor-arg ref="serializer"/>
    <constructor-arg ref="rabbitConnectionFactory"/>
    <constructor-arg value="commands"/>
  </bean>
  <bean id="splitRabbitPublisher" class="events.publisher.SplitPublisher">
    <constructor-arg>
      <map>
        <entry key="event" value-ref="rabbitEventPublisher"/>
        <entry key="command" value-ref="rabbitCommandPublisher"/>
      </map>
    </constructor-arg>
  </bean>
  <bean id="splitKafkaPublisher" class="events.publisher.SplitPublisher">
    <constructor-arg>
      <map>
        <entry key="event" value-ref="kafkaEventPublisher"/>
        <entry key="command" value-ref="kafkaCommandPublisher"/>
      </map>
    </constructor-arg>
  </bean>
  <bean id="splitDeserialiser" class="events.formatter.SplitDeserialiser">
    <constructor-arg>
      <map>
        <entry key="edaAvroGenericEvent" value-ref="edaAvroGenericDeserialiser"/>
        <entry key="rjs1GenericEvent" value-ref="rjs1Deserializer"/>
      </map>
    </constructor-arg>
  </bean>

  <bean id="transactionChargeHandler" class="application.handler.TransactionChargeHandler">
    <constructor-arg ref="messagePublisher"/>
  </bean>
  <bean id="refundCustomerHandler" class="application.handler.RefundCustomerHandler">
    <constructor-arg ref="messagePublisher"/>
  </bean>

  <bean id="hardCodedSchemaProvider" class="events.formatter.edaJsonSerDes.EDAJsonHardCodedSchemaProvider"/>
  <bean id="edaFileBasedSchemaProvider" class="events.formatter.edaAvroSerDes.EDAAvroFileBasedSchemaProvider"/>
  <bean id="schemaRegistry" class="events.formatter.SchemaRegistry"/>

  <alias name="schemaRegistry" alias="schemaProvider"/>
  <alias name="splitKafkaPublisher" alias="messagePublisher"/>
  <alias name="kafkaConsumer" alias="messageConsumer"/>
  <alias name="guavaDispatcher" alias="dispatcher"/>
  <alias name="edaAvroGenericSerialiser" alias="serializer"/>
  <alias name="messageFamilyAwareDeserializer" alias="deserializer"/>
  <!--alias name="splitDeserialiser" alias="deserializer"/-->
  <!--<alias name="rjs1Serializer" alias="serializer"/>-->
  <!--  <alias name="decoratedRjs1Serializer" alias="deserializer"/>-->
  <!--  <alias name="hav1Serializer" alias="serializer"/>-->

</beans>